# Описание базы данных «Управление школьной столовой»

База данных поддерживает веб‑приложение для учёта питания в школьной столовой: регистрацию учеников, работу поваров, управление меню, оплатами, заявками на закупки и отзывами о блюдах.

---

## 1. Пользователи и роли

### Таблица `users`

**Назначение:** хранит всех пользователей системы (ученики, повара, администраторы) и их учётные данные.

**Основные поля:**
- `id` — уникальный идентификатор пользователя (UUID, первичный ключ).
- `email` — электронная почта, используется как логин, уникальна.
- `password_hash` — хэш пароля пользователя.
- `role` — роль пользователя: `STUDENT`, `COOK`, `ADMIN`.
- `is_active` — флаг активности учётной записи.
- `created_at` — дата и время создания записи.
- `updated_at` — дата и время последнего обновления записи.

**Зачем:** единая таблица для всех типов пользователей упрощает авторизацию, а роли позволяют разграничивать доступ.

---

## 2. Профили учеников и поваров

### Таблица `student_profiles`

**Назначение:** хранит дополнительную информацию об учениках.

**Основные поля:**
- `id` — идентификатор профиля ученика (UUID).
- `user_id` — ссылка на пользователя (`users.id`), связь один‑к‑одному.
- `class_name` — класс ученика (например, `7А`).
- `allergies` — пищевые аллергии (JSON‑массив аллергенов).
- `preferences` — пищевые предпочтения (JSON, например, вегетарианец, без свинины).

**Зачем:** отделяет специфические для ученика данные от общей таблицы пользователей и позволяет учитывать ограничения по питанию.

---

### Таблица `cook_profiles`

**Назначение:** хранит дополнительные данные о сотрудниках столовой (поварах).

**Основные поля:**
- `id` — идентификатор профиля повара (UUID).
- `user_id` — ссылка на пользователя (`users.id`), связь один‑к‑одному.
- `position` — должность сотрудника (повар, заведующий и т.п.).

**Зачем:** гибко расширяет данные для персонала столовой и отделяет их от ученических профилей.

---

## 3. Меню и блюда

### Таблица `dishes`

**Назначение:** справочник блюд, которые могут использоваться в меню.

**Основные поля:**
- `id` — идентификатор блюда (UUID).
- `name` — название блюда.
- `description` — текстовое описание.
- `dish_type` — тип блюда или приёма пищи (`BREAKFAST`, `LUNCH`).
- `price` — цена одной порции.
- `calories` — калорийность (необязательное поле).
- `allergens` — список аллергенов (JSON‑массив).

**Зачем:** позволяет переиспользовать одно блюдо в разных меню и собирать по нему статистику и отзывы.

---

### Таблица `menus`

**Назначение:** описывает меню на определённую дату и тип приёма пищи.

**Основные поля:**
- `id` — идентификатор меню (UUID).
- `date` — дата действия меню.
- `meal_type` — тип приёма пищи (`BREAKFAST`, `LUNCH`).

**Зачем:** отделяет логическое понятие «меню на день/приём пищи» от конкретных блюд.

---

### Таблица `menu_items`

**Назначение:** связывает меню и блюда, а также хранит планируемые объёмы.

**Основные поля:**
- `id` — идентификатор строки меню (UUID).
- `menu_id` — ссылка на меню (`menus.id`).
- `dish_id` — ссылка на блюдо (`dishes.id`).
- `planned_quantity` — планируемое количество порций этого блюда.

**Зачем:** реализует связь многие‑ко‑многим между меню и блюдами и даёт основу для планирования и контроля остатков.

---

## 4. Оплата питания

### Таблица `payments`

**Назначение:** фиксирует все оплаты питания учениками — разовые и абонементы.

**Основные поля:**
- `id` — идентификатор платежа (UUID).
- `user_id` — плательщик, ссылка на `users.id`.
- `created_at` — дата и время совершения платежа.
- `amount` — сумма оплаты.
- `payment_type` — тип платежа: `SINGLE` (разовый) или `SUBSCRIPTION` (абонемент).
- `status` — статус платежа (например, `PAID`, `CANCELLED`).
- `menu_id` — ссылка на конкретное меню (для разовой оплаты конкретного завтрака/обеда, опционально).
- `subscription_from` — дата начала действия абонемента.
- `subscription_to` — дата окончания действия абонемента.

**Зачем:** позволяет отслеживать, кто и за что заплатил, а также строить отчёты по оплатам и периодам действия абонементов.

---

## 5. Отметка получения питания

### Таблица `meal_marks`

**Назначение:** фиксирует факт, что ученик получил питание на конкретном приёме пищи.

**Основные поля:**
- `id` — идентификатор отметки (UUID).
- `user_id` — ученик, ссылка на `users.id`.
- `menu_id` — меню/приём пищи, ссылка на `menus.id`.
- `marked_at` — дата и время отметки.

**Ограничения:**
- Уникальность пары (`user_id`, `menu_id`) — один ученик не может отметиться на одно и то же меню дважды.

**Зачем:** обеспечивает учёт посещаемости столовой, контроль получения питания и предотвращение повторных отметок.

---

## 6. Учёт выданных блюд и склад

### Таблица `served_dishes`

**Назначение:** фиксирует фактическую выдачу блюд с детализацией по блюдам и меню.