# Описание базы данных «Управление школьной столовой»

База данных поддерживает веб-приложение для школьной столовой: управление пользователями, меню, блюдами с аллергиями и предпочтениями, оплатами, отметками получения пищи, складом, закупками и отзывами.

---

## 1. Пользователи и профили

### Таблица `users`

**Назначение:** хранит учётные данные всех пользователей (ученики, повара, администраторы).

**Основные поля:**
- `id` — уникальный UUID, первичный ключ.
- `email` — логин, уникальный, индексированный.
- `passwordHash` — хэш пароля.
- `role` — роль: `STUDENT`, `COOK`, `ADMIN` (по умолчанию `STUDENT`).
- `isActive` — активность аккаунта (по умолчанию `true`).
- `createdAt`, `updatedAt` — timestamps создания и обновления.

**Связи:** профили учеников/поваров, платежи, отметки, отзывы.

**Зачем:** централизованная авторизация с ролями для разграничения доступа.

---

### Таблица `student_profiles`

**Назначение:** дополнительные данные учеников.

**Основные поля:**
- `id` — UUID, первичный ключ.
- `user_id` — связь 1:1 с `users.id`, уникальная.
- `class_name` — класс (например, `7А`).

**Связи:** многие-ко-многим с аллергиями, предпочтения (1:1).

**Зачем:** персонализация питания с учётом класса, аллергий и вкусов.

---

### Таблица `cook_profiles`

**Назначение:** данные поваров/персонала.

**Основные поля:**
- `id` — UUID.
- `user_id` — связь 1:1 с `users.id`.
- `position` — должность.

**Зачем:** расширяет профиль для сотрудников столовой.

---

## 2. Аллергии и предпочтения

### Таблица `allergies`

**Назначение:** справочник аллергенов (арахис, лактоза и т.д.).

**Основные поля:**
- `id` — UUID.
- `word` — название аллергена, уникальное.

**Связи:** многие-ко-многим с профилями учеников (`profile_allergies`) и блюдами (`dish_allergies`).

**Зачем:** нормализованный учёт аллергий для безопасности.

---

### Таблица `profile_allergies`

**Назначение:** связь учеников и аллергий (многие-ко-многим).

**Поля:** составной PK (`student_profile_id`, `allergy_id`).

**Зачем:** гибкое назначение нескольких аллергий одному ученику.

---

### Таблица `preferences`

**Назначение:** пищевые предпочтения ученика (вегетарианец, острое и т.д.).

**Основные поля:**
- `id` — UUID.
- `profile_id` — связь 1:1 с `student_profiles.id`.
- `word` — предпочтение.

**Зачем:** персональные вкусовые настройки.

---

### Таблица `dish_allergies`

**Назначение:** аллергии конкретных блюд (многие-ко-многим).

**Поля:** составной PK (`dish_id`, `allergy_id`).

**Зачем:** автоматическая проверка противопоказаний при составлении меню.

---

## 3. Блюда и меню

### Таблица `dishes`

**Назначение:** каталог всех блюд.

**Основные поля:**
- `id` — UUID.
- `name` — название, индексированное.
- `description` — описание.
- `dish_type` — тип (`breakfast`, `lunch`), индексированное.
- `price` — цена (Numeric).
- `calories` — калорийность.

**Связи:** аллергии, позиции в меню, отзывы.

**Зачем:** переиспользование блюд в разных меню с отзывами и статистикой.

---

### Таблица `menus`

**Назначение:** меню на конкретную дату и приём пищи.

**Основные поля:**
- `id` — UUID.
- `date` — дата, индексированная.
- `meal_type` — `breakfast` или `lunch`.

**Связи:** позиции меню.

**Зачем:** планирование ежедневного ассортимента.

---

### Таблица `menu_items`

**Назначение:** блюда в конкретном меню.

**Основные поля:**
- `id` — UUID.
- `menu_id`, `dish_id` — связи.
- `planned_quantity` — плановое количество порций.

**Зачем:** планирование объёмов и связь меню-блюда.

---

## 4. Оплата и учёт питания

### Таблица `payments`

**Назначение:** все платежи (разовые, абонементы).

**Основные поля:**
- `id` — UUID.
- `user_id` — плательщик.
- `amount` — сумма.
- `payment_type` — `SINGLE` или `SUBSCRIPTION`.
- `status` — `PAID` и др.
- `menu_id` — для разовых оплат.
- `subscription_from/to` — период абонемента.

**Зачем:** контроль финансов и доступности питания.

---

### Таблица `meal_marks`

**Назначение:** отметки получения пищи.

**Основные поля:**
- `id` — UUID.
- `user_id`, `menu_id` — уникальная пара.
- `marked_at` — время отметки.

**Зачем:** учёт посещаемости и выдачи порций.

---

### Таблица `served_dishes`

**Назначение:** фактическая выдача блюд.

**Основные поля:**
- `id` — UUID.
- `menu_item_id` — связь.
- `served_at` — время.
- `quantity` — количество.

**Зачем:** точный контроль расхода продуктов.

---

## 5. Склад и закупки

### Таблица `stock_items`

**Назначение:** текущие остатки продуктов.

**Основные поля:**
- `id` — UUID.
- `name` — продукт (картофель, молоко).
- `unit` — единица (кг, л).
- `quantity` — остаток.
- `updatedAt` — последнее обновление.

**Зачем:** управление запасами.

---

### Таблица `purchase_requests`

**Назначение:** заявки на закупки.

**Основные поля:**
- `id` — UUID.
- `created_by_id` — автор.
- `status` — `PENDING`, `APPROVED`, `REJECTED`.
- `approved_by_id`, `approvedAt` — утверждение.

**Связи:** позиции заявки.

**Зачем:** согласованный процесс пополнения склада.

---

### Таблица `purchase_request_items`

**Назначение:** товары в заявке.

**Основные поля:**
- `id` — UUID.
- `request_id` — связь.
- `product_name`, `unit`, `quantity`.

**Зачем:** детализация закупок.

---

## 6. Отзывы

### Таблица `reviews`

**Назначение:** оценки и комментарии к блюдам.

**Основные поля:**
- `id` — UUID.
- `user_id`, `dish_id` — связи.
- `rating` — 1–5.
- `comment` — текст.
- `createdAt` — время.

**Зачем:** обратная связь для улучшения меню.

---

Эта структура обеспечивает полный цикл: от планирования меню с учётом аллергий до учёта выдачи и складского хозяйства.